document.addEventListener("DOMContentLoaded",(()=>{console.log("FELIX ART FAIR V0.2, 2021");const t=document.body.getAttribute("data-baseUrl")+"/";main=document.querySelector("main"),footer=document.querySelector("footer"),navHandle=document.querySelector("footer .handle"),keys=document.querySelectorAll("a.key"),keywords=document.querySelectorAll("nav a"),knownKeywords=document.querySelector("footer > nav"),script=document.querySelector("#script"),keywordDialogue=document.querySelector("#keywordDialogue"),ambientDialogue=document.querySelector("#ambientDialogue"),galleryContent=document.querySelector("#galleryContent"),video=document.querySelector("#player"),videoToggle=document.querySelector("#toggleVideo"),videoClose=document.querySelector("#closeVideo"),dialogueSpeed=3800;let o=!1,n={location:script.firstElementChild.getAttribute("data-locationId"),index:0};const a=t=>{t.classList.contains("location")?t.addEventListener("click",(()=>{e.stopPropagation(),n=i(n,t)})):t.addEventListener("click",(e=>{e.stopPropagation(),c(t)}))},d=e=>{const t=e.getAttribute("data-keywordId");document.querySelectorAll('[data-keywordId="'+t+'"]').forEach((e=>{e.classList.toggle("highlight")}))},i=(e,o)=>{e.location=o.getAttribute("data-keywordId"),e.index=0;const n=script.querySelector('[data-locationId="'+e.location+'"]'),a=knownKeywords.querySelector('[data-keywordId="'+e.location+'"]');return"H4"==n.children[e.index].nodeName&&(e=r(e)),a.classList.add("visited"),window.history.pushState("","",t+e.location),y(),e},l=e=>{if(""!=e){let t=e.cloneNode(!0),o=t.querySelectorAll(".key");t.classList.add("active"),e.classList.add("active"),o.forEach((e=>{a(e),e.classList.contains("gallery")||knownKeywords.querySelector('[data-keywordId="'+e.getAttribute("data-keywordId")+'"]').classList.remove("hidden"),e.addEventListener("mouseenter",(()=>d(e))),e.addEventListener("mouseleave",(()=>d(e)))})),main.appendChild(t),t.style.display="block",null!=t.querySelector(".resumeBtn")?(L=!0,m(),v(),t.querySelector(".resumeBtn").addEventListener("click",(e=>{y(),t.addEventListener("transitionend",(()=>{t.remove()})),t.classList.remove("visible"),keywordDialogue.querySelector('[data-locationId="'+n.location+'"] [data-keywordid="'+t.getAttribute("data-keywordid")+'"]').classList.remove("active")}))):t.addEventListener("click",(e=>{n=r(n),w||y()})),window.requestAnimationFrame((()=>{const e=Math.round(48);let o=0;const n=()=>{let a=((e,t,o,n)=>o*e/n+t)(o,document.documentElement.scrollTop,t.offsetHeight,e);document.documentElement.scrollTop=a,o++,o<e&&requestAnimationFrame(n)};n(),t.classList.add("visible"),t.classList.contains("lyric")&&k(t)}))}},r=(e,t=!0)=>{let o=script.querySelector('[data-locationId="'+e.location+'"]'),n=o.children[e.index],a=!1;if(o.classList.contains("skip")&&(t=!0),e.index==o.children.length)if(t){o=o.nextElementSibling,e.location=o.getAttribute("data-locationId"),e.index=0,n=o.children[e.index];const t=knownKeywords.querySelector('[data-keywordId="'+e.location+'"]');t.classList.contains("hidden")&&t.classList.remove("hidden")}else a=!0;return a?m():(l(n),n.classList.contains("keywordDialogue")||e.index++,"H4"==n.nodeName&&(e=r(e))),e},c=e=>{const t=e.getAttribute("data-keywordId"),o=(e.getAttribute("data-keywordId"),keywordDialogue.querySelector('[data-locationId="'+n.location+'"]').querySelectorAll('[data-keywordId="'+t+'"]')),a=galleryContent.querySelector('[data-galleryId="'+t+'"]');let d=!1;o.forEach((e=>{e.classList.contains("active")||d||(l(e),d=!0)})),null!=a&&l(a),m()};keys.forEach((e=>{a(e)})),keys.forEach((e=>{e.addEventListener("mouseenter",(()=>d(e))),e.addEventListener("mouseleave",(()=>d(e)))}));const s=()=>{n=r(n,!1)},u=()=>{let e=ambientDialogue.querySelector('[data-locationId="'+n.location+'"]'),t=0,o=e.children[t];for(;o.classList.contains("active");){if(t++,null==e.children[t]){o=!1;break}o=e.children[t]}o?l(o):clearInterval(g)},m=()=>{main.classList.contains("paused")||(clearInterval(h),main.classList.add("idle"),w=!1,setTimeout((()=>{main.classList.remove("idle"),main.classList.add("paused")}),3500),L||(g=setInterval(u,1.5*dialogueSpeed)))},y=()=>{main.classList.contains("paused")&&(clearInterval(g),h=setInterval(s,dialogueSpeed),main.classList.remove("paused"),w=!0)},v=()=>{clearInterval(g)};let g,h=setInterval(s,dialogueSpeed),w=!0,L=!1;document.addEventListener("keydown",(e=>{switch(e.which){case 37:break;case 38:n=(e=>{const t=main.lastElementChild;return t.remove(),t.classList.contains("keywordDialogue")||e.index--,e})(n);break;case 39:case 40:n=r(n);break;default:return}e.preventDefault()})),document.addEventListener("touchstart",(e=>{e.target==navHandle&&(document.body.classList.add("locked"),o=!0)})),document.addEventListener("touchend",(e=>{e.target==navHandle&&(document.body.classList.remove("locked"),o=!1)})),document.addEventListener("touchmove",(e=>{if(o){const t=document.querySelectorAll("footer > *");let o=0;t.forEach((e=>{o+=e.offsetHeight})),o+=10,Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);const n=60;touch=e.changedTouches[0],footerOffset=footer.getBoundingClientRect(),distance=-1*Math.round(touch.clientY-footerOffset.top);let a=parseInt(getComputedStyle(footer).height)+distance;a<n&&(a=n),a>o&&(a=o),footer.style.height=a+"px"}}));const k=e=>{const t=e.querySelectorAll("i"),o=dialogueSpeed/20;t.forEach(((e,t)=>{setTimeout((()=>{e.classList.add("a")}),o*t)}))};if(null!=video){let e,t=document.createElement("script"),o=document.querySelectorAll("script")[0],n=video.getAttribute("data-src");t.src="https://www.youtube.com/iframe_api",o.parentNode.insertBefore(t,o),window.onYouTubeIframeAPIReady=function(){console.log("running"),e=new YT.Player("embed",{videoId:n,playerVars:{cotrols:0,autoplay:1,mute:1,showinfo:0,rel:0,modestbranding:1}})},videoToggle.addEventListener("click",(()=>{video.classList.toggle("active"),e.isMuted()&&e.unMute()})),videoClose.addEventListener("click",(()=>{video.remove()}))}(()=>{let e=window.location.pathname.split("/");e=e[e.length-1];const t=document.querySelector('[data-keywordID="'+e+'"]');if(""==e)return!1;n=i(n,t)})()||(n=r(n));const f=knownKeywords.querySelector('[data-keywordId="'+n.location+'"]');f.classList.add("visited"),f.classList.remove("hidden")}));